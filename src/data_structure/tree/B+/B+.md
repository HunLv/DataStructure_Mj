# B+ 树

## B+ 树 名字的含义

B 树的变体

注意：B- 和 B 是同一回事。

## 思考过程

1. 需求：按照区间进行查找。

2. 如何使二叉查找树支持区间查询？

   > 树中的节点并不存储数据本身，而是只是作为索引。
   >
   > 除此之外，我们把每个叶子节点串在一条链表上，链表中的数据是从小到大有序的。
   >
   > 只需要拿区间的起始值，在树中进行查找，当查找到某个叶子节点之后，我们再顺着链表往后遍历，直到链表中的结点数据值大于区间的终止值为止。所有遍历到的数据，就是符合区间值的所有数据。

3. 优化 1  索引太多，内存放不下。

   > 时间换空间——索引存储到磁盘中，降低速度。

4. 优化 2  二叉树高度太高，访问磁盘次数太多。

   > 二叉树高度太高，要减少 磁盘 IO 操作（每次査询数据时磁盘 IO 操作的次数 = 树的高度） 降低树的高度，构建 m 叉树。

5. 如何设置 设置分叉数 m 的大小？

   > 不管是内存中的数据，还是磁盘中的数据，操作系统都是按页（一页大小通常是4KB，这个值可以通过 getconfig PAGE_SIZE命令查看）来读取的，一次会读一页的数据。如果要读取的数据量超过一页的大小，就会触发多次IO操作。所以，我们在选择m大小的时候，要尽量让每个节点的大小等于一个页的大小。读取一个节点，只需要一次磁盘IO操作。

6. 索引的弊端是什么？

   > 写入数据的效率下降——因为数据的写入过程中，涉及到索引的更新。

## 应用场合

数据库的索引结构的设计。



## B + 树特点（大白话）

在B+树中，**叶结点 **包含信息，所有**非叶结点**仅起索引作用 ；

**非叶结点 ** 中的每个索引项只含有对应 **子树的最大关键字** 和 **指向该子树的指针**，**不含有该关键字对应记录的存储地址**。

B+ 树**叶子节点**的关键字从小到大有序排列，**左边结尾数据**都会保存**右边节点开始数据的指针**。

在B+树中，**叶结点 **包含了全部关键字，即在非叶结点中出现的关键字也会出现在叶结点 **重复出现** 中；而在B树中，叶结点包含的关键字和其他结点包含的关键字是不重复的。





## m 阶 B+ 树 特点（数字特征）

1. 一个关键字要对应一棵树。



## B 和 B+ 的对比

| 假设阶数都是 m    | B +                                                      | B                    |
| ----------------- | -------------------------------------------------------- | -------------------- |
| 节点的分支要求    |                                                          |                      |
| 存储特点          | 非叶节点不保存数据，仅保存索引；<br />叶子节点保存数据。 | 所有节点都保存数据。 |
| 形状区别          | 叶子节点连成一条链，便于区间查询                         | 叶子节点分散         |
| 阶数 m 的数字特征 | 最大分支分支为 m<br />                                   | 最大分支为 m         |

## 考研题目

![image-20200904222948453](img/image-20200904222948453.png)

答案

![image-20200904223235370](img/image-20200904223235370.png)